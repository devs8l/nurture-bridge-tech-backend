# ============================================================================
# INQUANTIC FOUNDRY - DOCKER COMPOSE
# Production-ready configuration using cloud services
# ============================================================================

services:
  app:
    build: .
    image: nurture-bridge-api
    ports:
      - "8000:8080"
    env_file:
      - .env
    environment:
      - PORT=8080
    restart: unless-stopped


# services:
#   # ============================================================================
#   # APPLICATION - FastAPI Backend
#   # ============================================================================
#   app:
#     build:
#       context: .
#       dockerfile: Dockerfile
#     container_name: nurture-bridge-api
#     ports:
#       - "8080:8080"
#     env_file:
#       - .env
#     environment:
#       - ENVIRONMENT=development
#     networks:
#       - nurture-bridge-network
#     restart: unless-stopped
#     healthcheck:
#       test: ["CMD", "curl", "-f", "http://localhost:8080/api/v1/health"]
#       interval: 30s
#       timeout: 10s
#       retries: 3

  # ============================================================================
  # LOCAL POSTGRESQL - OPTIONAL (for local development/testing)
  # ============================================================================
  # Uncomment if you want to use local database instead of Neon cloud
  # Remember to update DATABASE_URL in .env to: postgresql+asyncpg://postgres:postgres@db:5432/inquantic
  # 
  # db:
  #   image: postgres:16-alpine
  #   container_name: inquantic-db
  #   environment:
  #     - POSTGRES_USER=postgres
  #     - POSTGRES_PASSWORD=postgres
  #     - POSTGRES_DB=inquantic
  #     - PGDATA=/var/lib/postgresql/data/pgdata
  #   ports:
  #     - "5432:5432"
  #   volumes:
  #     - postgres-data:/var/lib/postgresql/data
  #   networks:
  #     - inquantic-network
  #   restart: unless-stopped
  #   healthcheck:
  #     test: ["CMD-SHELL", "pg_isready -U postgres"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5

  # ============================================================================
  # REDIS - OPTIONAL (for caching/Celery)
  # ============================================================================
  # Uncomment if you need Redis for caching or Celery
  # 
  # redis:
  #   image: redis:7-alpine
  #   container_name: inquantic-redis
  #   ports:
  #     - "6379:6379"
  #   volumes:
  #     - redis-data:/data
  #   networks:
  #     - inquantic-network
  #   restart: unless-stopped
  #   healthcheck:
  #     test: ["CMD", "redis-cli", "ping"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5
  #   command: redis-server --appendonly yes

  # ============================================================================
  # CELERY WORKER - OPTIONAL (for background tasks)
  # ============================================================================
  # Uncomment if you need background task processing
  # Also uncomment redis service above
  # 
  # celery-worker:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #   container_name: inquantic-celery-worker
  #   command: celery -A tasks.worker worker --loglevel=info
  #   env_file:
  #     - .env
  #   environment:
  #     - ENVIRONMENT=development
  #   depends_on:
  #     - redis
  #   volumes:
  #     - .:/app
  #     - ./logs:/logs
  #   networks:
  #     - inquantic-network
  #   restart: unless-stopped

  # ============================================================================
  # CELERY BEAT - OPTIONAL (for scheduled tasks)
  # ============================================================================
  # Uncomment if you need scheduled tasks
  # Also uncomment redis service above
  # 
  # celery-beat:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #   container_name: inquantic-celery-beat
  #   command: celery -A tasks.worker beat --loglevel=info
  #   env_file:
  #     - .env
  #   environment:
  #     - ENVIRONMENT=development
  #   depends_on:
  #     - redis
  #   volumes:
  #     - .:/app
  #     - ./logs:/logs
  #   networks:
  #     - inquantic-network
  #   restart: unless-stopped

# ============================================================================
# VOLUMES (only needed if using local services)
# ============================================================================
# volumes:
#   postgres-data:
#     driver: local
#   redis-data:
#     driver: local

# # ============================================================================
# # NETWORKS
# # ============================================================================
# networks:
#   inquantic-network:
#     driver: bridge